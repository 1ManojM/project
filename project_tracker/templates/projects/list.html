{% extends "base.html" %}
{% block title %}Projects{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h5 class="mb-0">Projects</h5>
  <a class="btn btn-primary btn-sm" href="{% url 'projects:create' %}">Add Project</a>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <table class="table table-striped mb-0">
      <thead>
        <tr>
          <th>Name</th>
          <th>Client</th>
          <th>Manager</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        {% for p in projects %}
        <tr>
          <td><a href="{% url 'projects:detail' p.id %}">{{ p.name }}</a></td>
          <td>{{ p.client.name }}</td>
          <td>{{ p.manager }}</td>
          <td><span class="badge bg-info">{{ p.get_status_display }}</span></td>

          <td class="text-end">
            <a href="{% url 'projects:edit' p.id %}" class="btn btn-sm btn-outline-primary">Edit</a>

            <!-- Delete Button (opens modal) -->
            <button type="button"
                    class="btn btn-sm btn-outline-danger"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal"
                    data-delete-url="{% url 'projects:delete' p.id %}">
                Delete
            </button>
          </td>
        </tr>

        {% empty %}
        <tr>
          <td colspan="5" class="text-center p-3">No projects</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>


<!-- ======================================= -->
<!-- DELETE CONFIRMATION MODAL -->
<!-- ======================================= -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        Are you sure you want to delete this project?
      </div>

      <div class="modal-footer">
        <form id="deleteForm" method="post">
          {% csrf_token %}
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>

    </div>
  </div>
</div>


<!-- ======================================= -->
<!-- JAVASCRIPT: SET DELETE FORM ACTION URL -->
<!-- ======================================= -->
<script>
document.addEventListener('DOMContentLoaded', function () {

  var deleteModal = document.getElementById('deleteModal');

  deleteModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var deleteUrl = button.getAttribute('data-delete-url');

      document.getElementById('deleteForm').setAttribute('action', deleteUrl);
  });

});
</script>

{% endblock %}
